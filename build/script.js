// Generated by CoffeeScript 1.10.0
(function() {
  var makePayload, makeRequest;

  Webcam.set({
    width: 320,
    height: 240,
    dest_width: 320,
    dest_height: 240,
    image_format: 'jpeg',
    jpeg_quality: 90
  });

  Webcam.attach('#my_camera');

  window.take_snapshot = function() {
    return Webcam.snap(function(data_uri) {
      var apiKey, payload;
      apiKey = window.apiKey;
      payload = makePayload(data_uri);
      makeRequest(apiKey, payload);
      return document.getElementById('results').innerHTML = '<h2>Here is your large image:</h2>' + '<img src="' + data_uri + '"/>';
    });
  };

  makePayload = function(dataUri) {
    var commaIdx, payload;
    commaIdx = dataUri.indexOf(",");
    dataUri = dataUri.substring(commaIdx + 1);
    return payload = {
      requests: [
        {
          image: {
            content: dataUri
          },
          features: [
            {
              type: "FACE_DETECTION",
              maxResults: 1
            }
          ]
        }
      ]
    };
  };

  makeRequest = function(apiKey, payload) {
    var http, url;
    url = "https://vision.googleapis.com/v1/images:annotate?key=" + apiKey;
    http = new XMLHttpRequest();
    http.open("POST", url, true);
    http.setRequestHeader("Content-Type", "application/json");
    http.onreadystatechange = function() {
      if (http.readyState === 4 && http.status === 200) {
        return console.log(http.responseText);
      }
    };
    return http.send(JSON.stringify(payload));
  };

}).call(this);
